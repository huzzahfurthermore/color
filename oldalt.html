<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/png"
		href="https://support.content.office.net/en-us/media/88a91cba-a9e9-48cb-9a93-6d9d2f7b0197.png">
	<title>ANSI Color Converter</title>
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Code+Pro|Quantico:400,400italic,700">
	<style>
.color {
  display: inline-block;
  margin-right: 10px;
  margin-bottom: 5px;
  width: 50px;
  height: 20px;
  border-right: 1px solid #ffffff;
  border-left: 1px solid #ffffff;
  cursor: pointer;
}

@media only screen and (max-width: 999px) {
  .color {
    width: 25px;
  }
}

@media only screen and (max-width: 699px) {
  .color {
    width: 20px;
  }
}

body {
  background-color: black;
  color: #AAAAAA;
  font-family: "Source Code Pro";
}

#editor-container {
  position: relative;
  width: 99%;
  height: 150px;
  margin-bottom: 15px;
}

#editor-container, #textInput, #highlightLayer {}

#textInput, #highlightLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 99%;
  height: 100%;
  margin: 0;
  padding: 5px;
  font-family: "Source Code Pro", monospace;
  font-size: 14px;
  line-height: 1.25;
  background-color: transparent;
  color: #AAAAAA;
  white-space: pre-wrap;
  border: 1px solid #ccc;
  overflow: scroll;
  box-sizing: border-box;
}

#highlightLayer {
  z-index: 0;
  pointer-events: none;
}

.highlight {
  color: #696969;
  font-weight: bold;

}

.highlightNormal {
  color: #3a3a3a;
  font-weight: bold;
}

.footer {
  position: relative;
  right: 10px;
  text-align: right;
  width: 100%;
}

a {
  color: #AAAAAA;
}
</style>
</head>

<body onbeforeunload="return myFunction()">
	<!-- <h1>ANSI Color Converter</h1> -->
	<div id="colorPalette"></div>
	<div id="editor-container">
		<textarea id="textInput" placeholder="Enter text to be recolored..." spellcheck="true"
			oninput="updateHighlight()"></textarea>
		<div id="highlightLayer"></div>
	</div>
	<!-- <div id="rawOutput">Colored text will appear here</div> -->
	<div id="output">Colored text will appear here</div>
	<br><br><div class="footer"><a href="/">Textbox highlighting</a>, <a href="/gradient">Gradient Maker</a></div>

	<script>
	  function myFunction() {
      return "Input is not saved.";
    }
    
		const colorDict = {
			1: "#000000",
			2: "#800000",
			3: "#008000",
			4: "#808000",
			5: "#000080",
			6: "#800080",
			7: "#008080",
			8: "#c0c0c0",
			9: "#808080",
			10: "#ff0000",
			11: "#00ff00",
			12: "#ffff00",
			13: "#0000ff",
			14: "#ff00ff",
			15: "#00ffff",
			16: "#ffffff",
			17: "#000000",
			18: "#00005f",
			19: "#000087",
			20: "#0000af",
			21: "#0000d7",
			22: "#0000ff",
			23: "#005f00",
			24: "#005f5f",
			25: "#005f87",
			26: "#005faf",
			27: "#005fd7",
			28: "#005fff",
			29: "#008700",
			30: "#00875f",
			31: "#008787",
			32: "#0087af",
			33: "#0087d7",
			34: "#0087ff",
			35: "#00af00",
			36: "#00af5f",
			37: "#00af87",
			38: "#00afaf",
			39: "#00afd7",
			40: "#00afff",
			41: "#00d700",
			42: "#00d75f",
			43: "#00d787",
			44: "#00d7af",
			45: "#00d7d7",
			46: "#00d7ff",
			47: "#00ff00",
			48: "#00ff5f",
			49: "#00ff87",
			50: "#00ffaf",
			51: "#00ffd7",
			52: "#00ffff",
			53: "#5f0000",
			54: "#5f005f",
			55: "#5f0087",
			56: "#5f00af",
			57: "#5f00d7",
			58: "#5f00ff",
			59: "#5f5f00",
			60: "#5f5f5f",
			61: "#5f5f87",
			62: "#5f5faf",
			63: "#5f5fd7",
			64: "#5f5fff",
			65: "#5f8700",
			66: "#5f875f",
			67: "#5f8787",
			68: "#5f87af",
			69: "#5f87d7",
			70: "#5f87ff",
			71: "#5faf00",
			72: "#5faf5f",
			73: "#5faf87",
			74: "#5fafaf",
			75: "#5fafd7",
			76: "#5fafff",
			77: "#5fd700",
			78: "#5fd75f",
			79: "#5fd787",
			80: "#5fd7af",
			81: "#5fd7d7",
			82: "#5fd7ff",
			83: "#5fff00",
			84: "#5fff5f",
			85: "#5fff87",
			86: "#5fffaf",
			87: "#5fffd7",
			88: "#5fffff",
			89: "#870000",
			90: "#87005f",
			91: "#870087",
			92: "#8700af",
			93: "#8700d7",
			94: "#8700ff",
			95: "#875f00",
			96: "#875f5f",
			97: "#875f87",
			98: "#875faf",
			99: "#875fd7",
			100: "#875fff",
			101: "#878700",
			102: "#87875f",
			103: "#878787",
			104: "#8787af",
			105: "#8787d7",
			106: "#8787ff",
			107: "#87af00",
			108: "#87af5f",
			109: "#87af87",
			110: "#87afaf",
			111: "#87afd7",
			112: "#87afff",
			113: "#87d700",
			114: "#87d75f",
			115: "#87d787",
			116: "#87d7af",
			117: "#87d7d7",
			118: "#87d7ff",
			119: "#87ff00",
			120: "#87ff5f",
			121: "#87ff87",
			122: "#87ffaf",
			123: "#87ffd7",
			124: "#87ffff",
			125: "#af0000",
			126: "#af005f",
			127: "#af0087",
			128: "#af00af",
			129: "#af00d7",
			130: "#af00ff",
			131: "#af5f00",
			132: "#af5f5f",
			133: "#af5f87",
			134: "#af5faf",
			135: "#af5fd7",
			136: "#af5fff",
			137: "#af8700",
			138: "#af875f",
			139: "#af8787",
			140: "#af87af",
			141: "#af87d7",
			142: "#af87ff",
			143: "#afaf00",
			144: "#afaf5f",
			145: "#afaf87",
			146: "#afafaf",
			147: "#afafd7",
			148: "#afafff",
			149: "#afd700",
			150: "#afd75f",
			151: "#afd787",
			152: "#afd7af",
			153: "#afd7d7",
			154: "#afd7ff",
			155: "#afff00",
			156: "#afff5f",
			157: "#afff87",
			158: "#afffaf",
			159: "#afffd7",
			160: "#afffff",
			161: "#d70000",
			162: "#d7005f",
			163: "#d70087",
			164: "#d700af",
			165: "#d700d7",
			166: "#d700ff",
			167: "#d75f00",
			168: "#d75f5f",
			169: "#d75f87",
			170: "#d75faf",
			171: "#d75fd7",
			172: "#d75fff",
			173: "#d78700",
			174: "#d7875f",
			175: "#d78787",
			176: "#d787af",
			177: "#d787d7",
			178: "#d787ff",
			179: "#d7af00",
			180: "#d7af5f",
			181: "#d7af87",
			182: "#d7afaf",
			183: "#d7afd7",
			184: "#d7afff",
			185: "#d7d700",
			186: "#d7d75f",
			187: "#d7d787",
			188: "#d7d7af",
			189: "#d7d7d7",
			190: "#d7d7ff",
			191: "#d7ff00",
			192: "#d7ff5f",
			193: "#d7ff87",
			194: "#d7ffaf",
			195: "#d7ffd7",
			196: "#d7ffff",
			197: "#ff0000",
			198: "#ff005f",
			199: "#ff0087",
			200: "#ff00af",
			201: "#ff00d7",
			202: "#ff00ff",
			203: "#ff5f00",
			204: "#ff5f5f",
			205: "#ff5f87",
			206: "#ff5faf",
			207: "#ff5fd7",
			208: "#ff5fff",
			209: "#ff8700",
			210: "#ff875f",
			211: "#ff8787",
			212: "#ff87af",
			213: "#ff87d7",
			214: "#ff87ff",
			215: "#ffaf00",
			216: "#ffaf5f",
			217: "#ffaf87",
			218: "#ffafaf",
			219: "#ffafd7",
			220: "#ffafff",
			221: "#ffd700",
			222: "#ffd75f",
			223: "#ffd787",
			224: "#ffd7af",
			225: "#ffd7d7",
			226: "#ffd7ff",
			227: "#ffff00",
			228: "#ffff5f",
			229: "#ffff87",
			230: "#ffffaf",
			231: "#ffffd7",
			232: "#ffffff",
			233: "#080808",
			234: "#121212",
			235: "#1c1c1c",
			236: "#262626",
			237: "#303030",
			238: "#3a3a3a",
			239: "#444444",
			240: "#4e4e4e",
			241: "#585858",
			242: "#626262",
			243: "#6c6c6c",
			244: "#767676",
			245: "#808080",
			246: "#8a8a8a",
			247: "#949494",
			248: "#9e9e9e",
			249: "#a8a8a8",
			250: "#b2b2b2",
			251: "#bcbcbc",
			252: "#c6c6c6",
			253: "#d0d0d0",
			254: "#dadada",
			255: "#e4e4e4",
			256: "#eeeeee"
		};

		const colorPalette = document.getElementById('colorPalette');
		for (const code in colorDict) {
			const colorName = colorDict[code];
			const colorDiv = document.createElement('div');
			colorDiv.classList.add('color');
			colorDiv.style.backgroundColor = colorName;
			colorDiv.title = code;
			colorDiv.addEventListener('click', function () {
				applyColor(colorName, parseInt(code));
			});
			colorPalette.appendChild(colorDiv);
		}

		const textInput = document.getElementById('textInput');

		document.getElementById('textInput').addEventListener('input', updateOutput);

		function applyColor(color, code) {
			const selectionStart = textInput.selectionStart;
			const selectionEnd = textInput.selectionEnd;
			const text = textInput.value;
			let newText;

			if (selectionStart !== selectionEnd) {
				const selectedText = text.slice(selectionStart, selectionEnd);
				const numberRegex = /^\d+$/;

				if (numberRegex.test(selectedText)) {
					if (code == 16 || code == 232) {
						newText = text.slice(0, selectionStart) + `%bright` + text.slice(selectionEnd);
					} else {
						newText = text.slice(0, selectionStart) + code + text.slice(selectionEnd);
					}
				} else {
					if (code == 16 || code == 232) {
						newText = text.slice(0, selectionStart) + `%bright${selectedText}%normal` + text.slice(selectionEnd);
					} else {
						newText = text.slice(0, selectionStart) + `%(${code})${selectedText}%normal` + text.slice(selectionEnd);
					}
				}
			} else {
				if (code == 16 || code == 232) {
					newText = text.slice(0, selectionStart) + `%bright%normal` + text.slice(selectionStart);
				} else {
					newText = text.slice(0, selectionStart) + `%(${code})%normal` + text.slice(selectionStart);
				}
			}

			textInput.value = newText;
			updateOutput();

			const newCursorPosition = selectionStart + (code == 16 || code == 232 ? 7 : code.toString().length + 3);
			textInput.setSelectionRange(newCursorPosition, newCursorPosition);
			textInput.focus();
		}

		function updateOutput() {
			const textInput = document.getElementById('textInput').value;
			const outputElement = document.getElementById('output');

			const paragraphs = textInput.split('\n');
			let result = '';

			paragraphs.forEach(paragraph => {
				let currentIndex = 0;
				let paragraphResult = '';

				while (currentIndex < paragraph.length) {
					if (paragraph[currentIndex] === '%') {
						if (paragraph.startsWith('%(', currentIndex)) {
							const codeEndIndex = paragraph.indexOf(')', currentIndex + 2);
							if (codeEndIndex !== -1) {
								const code = paragraph.slice(currentIndex + 2, codeEndIndex);
								const colly = code.replace(/^0+(?=\d)/, '');
								if (colorDict.hasOwnProperty(colly)) {
									const colorName = colorDict[colly];
									const nextNormalIndex = paragraph.indexOf('%normal', codeEndIndex + 1);
									const content = nextNormalIndex !== -1
										? paragraph.slice(codeEndIndex + 1, nextNormalIndex)
										: paragraph.slice(codeEndIndex + 1);
									paragraphResult += `<span style="color: ${colorName};">${content}</span>`;
									currentIndex = nextNormalIndex !== -1 ? nextNormalIndex + 7 : paragraph.length;
									continue;
								}
							}
						} else if (paragraph.startsWith('%bright', currentIndex)) {
							const nextNormalIndex = paragraph.indexOf('%normal', currentIndex + 7);
							const content = nextNormalIndex !== -1
								? paragraph.slice(currentIndex + 7, nextNormalIndex)
								: paragraph.slice(currentIndex + 7);
							paragraphResult += `<span style="color:white">${content}</span>`;
							currentIndex = nextNormalIndex !== -1 ? nextNormalIndex + 7 : paragraph.length;
							continue;
						}
					}
					paragraphResult += paragraph[currentIndex];
					currentIndex++;
				}

				result += `<span>${paragraphResult}</span><br>`;
			});

			outputElement.innerHTML = result;
		}

		updateOutput();
	</script>
</body>
</html>
